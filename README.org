#+TITLE: theherk commons
#+SUBTITLE: Common Environment Configuration
#+AUTHOR: Adam Sherwood
#+EMAIL: theherk@gmail.com

These are the configuration details and files I use to configure my environment. Feel free to peruse if it suits you.

[[#screenshots][Screenshots can be found below.]]

* Tools

** Editors

I use Emacs almost exclusively, though I still haven't used it as long as I did Vim; 7 years to about 24 respectively. I have really enjoyed the work happening on Helix, but it is unlikely that Emacs will ever be replaced. It is just too good.

- [[https://github.com/hlissner/doom-emacs][Doom Emacs]]: [[file:.config/doom/config.org][configuration]], [[https://github.com/protesilaos/ef-themes][ef-themes winter]]
- [[https://helix-editor.com/][Helix Editor]]: [[https://github.com/helix-editor/helix/wiki/Themes#tokyo-night][tokyonight]]

** Terminal

- [[https://fishshell.com/][fish]]
- [[https://github.com/akermu/emacs-libvterm][vterm]]
- [[https://wezfurlong.org/wezterm/][Wezterm]]: [[file:.config/wezterm/wezterm.lua][configuration]], [[https://wezfurlong.org/wezterm/colorschemes/t/index.html#tokyonight][tokyonight]]

** Font

I use [[https://rubjo.github.io/victor-mono/][VictorMono]], and it is superb.

** Languages

I use these mostly, though others are supported.

- [[https://www.rust-lang.org/][Rust]]
- [[https://www.python.org/][Python]]
- [[https://go.dev/][Go]]

** Utilities

A partial list of installed tools:

- [[https://asciinema.org/][asciinema]]: Record and share terminal sessions.
- [[https://github.com/sharkdp/bat][bat]]: A cat clone.
- [[https://github.com/caddyserver/caddy][caddy]]: Simple file server.
- [[https://www.gnu.org/software/coreutils/][coreutils]]: GNU core utilities.
- [[https://direnv.net/][direnv]]: Environment manipulation.
- [[https://github.com/xiaogdgenuine/Doll][doll]]: Move dock applications to menu bar.
- [[https://formulae.brew.sh/cask/dropbox][dropbox]]: Only for syncing org directory.
- [[https://editorconfig.org/][editorconfig]]: Enforce some text styles.
- [[https://the.exa.website/][exa]]: A modern replacement for ls.
- [[https://github.com/sharkdp/fd][fd]]: Fast, user-friendly find.
- [[https://github.com/junegunn/fzf][fzf]]: Command-line fuzzy finder.
- [[https://www.mozilla.org/en-US/firefox/new/][firefox]]: [[https://color.firefox.com/?theme=XQAAAAIOAQAAAAAAAABBKYhm849SCia2CaaEGccwS-xMDPr0sKyHm0LFtsAuOs5Hgc59MzILXCVRpjcIcxKwXf-yc__PKRtJvTLuqCwxEvSIG5G-JU2nV8QMryjBVOlGDzRqLdB29oIFwqvIfpV4XWTC1uKCh3ILvcnJhfHuMoyL5sRfBa2iZxDB_ya6eVp-KaVwghWkUDYPaLkOR63d33whjJPzYrpf2sh9d2ppdtku_Z76zswg][color]]
- [[https://github.com/dandavison/delta][git-delta]]: Syntax highlighting pager.
- [[https://github.com/extrawurst/gitui][gitui]]: Fast terminal ui for git.
- [[https://github.com/joeyespo/grip][grip]]: Preview markdown.
- [[https://keepingyouawake.app/][keepingyouawake]]: Prevents your Mac from going to sleep with one click.
- [[https://github.com/keycastr/keycastr][keycastr]]: keystroke visualizer
- [[https://github.com/denisidoro/navi][navi]]: Interactive cheatsheet tool for the command-line.
- [[https://ohmyz.sh/][oh-my-zsh]]: Zsh configuration management.
- [[https://pandoc.org/][pandoc]]: Universal document converter.
- [[https://podman.io/][podman]]: Daemonless container engine.
- [[https://github.com/pyenv/pyenv][pyenv]]: Simple python version management.
- [[https://github.com/BurntSushi/ripgrep][ripgrep]]: Amazing search tool.
- [[https://github.com/Shopify/shadowenv][shadowenv]]: Slightly better, but less integrated environment manipulation.
- [[https://github.com/lotabout/skim][skim]]: Awesome fuzzy finder.
- [[https://starship.rs/][starship]]: Customizable prompt.
- [[https://www.terraform.io/][terraform]]: Infrastructure management tool.
- [[https://github.com/XAMPPRocky/tokei][tokei]]: Great tool for counting code.
- [[https://github.com/ducaale/xh][xh]]: Friendly tool for sending http requests.

* Installation

Get this from git. For you:

#+begin_src shell
git clone https://github.com/theherk/commons.git ~/commons
#+end_src

For me:

#+begin_src shell
ssh-keygen -t ed25519
ssh-add .ssh/id_ed25519.pub
#+end_src

Then add this key to Github. Followed by:

#+begin_src shell
git clone git@github.com:theherk/commons.git ~/commons
#+end_src

* Usage

First, after getting the repository, install [[https://brew.sh/][Homebrew]]:

#+begin_src shell
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
#+end_src

Then, you must install temurin. It will be needed for the oh-my-zsh installation to succeed.

#+begin_src shell
brew install temurin
#+end_src

Now, install zsh tools and link all the configurations.

#+begin_src shell
mkdir -p .config projects
./commons/links.sh
sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" # install oh-my-zsh
git clone https://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions
#+end_src

That will link all the configurations where they need to be. Then we just need to set about installing things. This is tailored to MacOS, since that is what I use nearly always, now.

#+begin_src shell
xcode-select --install
#+end_src

*** Install many tools:

#+begin_src shell
brew tap cjbassi/ytop
brew tap homebrew/cask-fonts
brew tap helix-editor/helix
brew tap wez/wezterm
brew install --cask \
    apptivate \
    homebrew/cask-fonts/font-victor-mono-nerd-font \
    keepingyouawake \
    keycastr \
    wez/wezterm/wezterm
brew install \
    archey \
    asciinema \
    aspell \
    bat \
    bottom \
    caddy \
    clang-format \
    coreutils \
    direnv \
    doll \
    dropbox \
    dua-cli \
    dust \
    editorconfig \
    exa \
    fd \
    fish \
    fzf \
    ghc \
    git \
    git-delta \
    gitui \
    gnu-units \
    gnupg \
    grip \
    helix \
    jq \
    kubectl \
    lazygit \
    lazydocker \
    mactex \
    markdown \
    navi \
    newman \
    npm \
    onefetch \
    pandoc \
    pinentry-mac \
    plantuml \
    podman \
    postman \
    procs \
    pyenv \
    pygments \
    ripgrep \
    rust-analyzer \
    shadowenv \
    shellcheck \
    sk \
    starship \
    terraform \
    terraform-ls \
    tokei \
    translate-shell \
    wget \
    xh \
    zenith
#+end_src

*** Change Shell to Fish.

First, you must add to the "List of acceptable shells". Then you can change to it.

#+begin_src shell
echo $(which fish) | sudo tee -a /etc/shells
chsh -s $(which fish)
#+end_src

*** Install Emacs.

There are slight differences in amd64 and arm64 paths.

#+begin_src shell
brew tap d12frosted/emacs-plus
brew install emacs-plus --with-memeplex-slim-icon --with-native-comp --with-no-titlebar-and-round-corners
cp -r /usr/local/opt/emacs-plus@28/Emacs.app /Applications/
git clone --depth 1 https://github.com/hlissner/doom-emacs ~/.emacs.d # install doom
doom install
brew services start emacs-plus
# create automator routine emacs-everywhere and bind M-S-space
# can be imported from icloud; basically command script service invoking
# /opt/homebrew/bin/emacsclient --eval "(emacs-everywhere)"
# needs to be full path result of which emacsclient
doom sync
ln -sf ~/Dropbox/org ~/
ln -sf ~/commons/.config/ispell/ ~/.emacs.d/.local/etc/
#+end_src

*** Add pinentry for mac into gpg configuration.

#+begin_src shell
echo "pinentry-program $(which pinentry-mac)" >>~/.gnupg/gpg-agent.conf
gpgconf --kill gpg-agent
#+end_src

*** Install more programming tools.

**** Install Go from https://golang.org/doc/install.

Followed by:

#+begin_src shell
go install \
    github.com/cweill/gotests/...@latest \
    github.com/fatih/gomodifytags@latest \
    github.com/motemen/gore/...@latest \
    github.com/nsf/gocode@latest \
    golang.org/x/tools/...@latest
#+end_src

**** Install Rust.

#+begin_src shell
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh # install rust
rustup toolchain add nightly
cargo +nightly install racer
rustup default nightly
rustup component add rust-src rustc-dev llvm-tools-preview
#+end_src

**** Some npm tools.

#+begin_src shell
npm i -g js-beautify stylelint
npm audit fix
npm i --pack-lock-only
npm audit fix # seems to work after package lock
#+end_src

**** Prepare Python.

#+begin_src shell
# With M1:
# see: https://github.com/pyenv/pyenv/issues/1768#issuecomment-871602950
# also: https://stackoverflow.com/questions/71577626/issues-installing-python-3-8-10-on-macos-12-3-monterey
pyenv install 3.9.11
pyenv install 3.10.3
pyenv global 3.10.3
pip install black isort keyring nose pipenv pyflakes pyppeteer pytest
#+end_src

*** Setup git forge

This is an optional step, and will merge all owner repositories to their correct homes in =~/projects/=.

First, ensure the requisite directories exist, install [[https://github.com/hakoerber/git-repo-manager][git-repo-manager]], and link the configuration files into the correct locations.

#+begin_src shell
mkdir -p $P/github.com $P/gitlab.com
cargo +nightly install git-repo-manager
ln -sf ~/commons/.config/grm/github.com/config.toml $P/github.com/config.toml
ln -sf ~/commons/.config/grm/gitlab.com/config.toml $P/gitlab.com/config.toml
#+end_src

Then, you must store personal access tokens in the keyring.

#+begin_src shell
pwa github.com theherk@gmail.com
pwa gitlab.com theherk@gmail.com
#+end_src

Lastly, sync the repositories. These could be shared manifests, but for now this granular approach is chosen.

#+begin_src shell
cd $P/github.com && grm repos sync config
cd $P/gitlab.com && grm repos sync config
#+end_src

*** MacOS windows manager

**** Dock

#+begin_src shell
defaults write com.apple.dock tilesize -float 32
defaults read com.apple.dock orientation -string right
defaults write com.apple.dock autohide -bool true
killall Dock
#+end_src

**** Notifications

Since the dock is usually hidden, use [[https://github.com/xiaogdgenuine/Doll][Doll]] to load apps into menu bar.

*** Here be dagrons (with consummate V's of course)

Sometimes you use =sudo= a lot. A responsible nerd will tell you not to do this, but =¯\_(ツ)_/¯=... Well, I set up an ssh tunnel to proxy for git several times daily so... Look, what I'm trying to say is, "We don't get into this business to input /extra/ keystrokes."

#+begin_src shell
echo 'h4s ALL = NOPASSWD: /usr/bin/ssh' >> /etc/sudoers
#+end_src

If you get an error =zsh: permission denied: /etc/sudoers=, and you don't know how to get around it, I implore you; do not do this.

* Screenshots

** Desktop

#+html: <p align="center"><img src="./img/desktop.png" alt="desktop" /></p>

** Emacs

#+html: <p align="center"><img src="./img/emacs-splash.png" alt="emacs splash screen" /></p>
#+html: <p align="center"><img src="./img/emacs-treemacs.png" alt="emacs treemacs" /></p>
#+html: <p align="center"><img src="./img/emacs-dired.png" alt="emacs dired" /></p>
#+html: <p align="center"><img src="./img/emacs-org-zen.png" alt="emacs org zen" /></p>

** Firefox

#+html: <p align="center"><img src="./img/firefox-music.png" alt="firefox" /></p>

** Slack

#+html: <p align="center"><img src="./img/slack.png" alt="slack" /></p>

** Wezterm

#+html: <p align="center"><img src="./img/wezterm-lists.png" alt="wezterm lists" /></p>
#+html: <p align="center"><img src="./img/wezterm-sysinfo.png" alt="wezterm sysinfo" /></p>

* Credits

More are warranted, but the two I can think to mention off the bat are:

- [[https://www.deviantart.com/matlocktheartist/art/Bruce-Lee-Puzzled-322967405][matlocktheartist]] for providing the awesome Bruce Lee art.

* Enjoy
